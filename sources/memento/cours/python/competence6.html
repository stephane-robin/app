<h2>Environnement de travail</h2>


<!-----------------------
ENVIRONNEMENTS DE TRAVAIL
------------------------>

  <h3 id="py_environnement">Les environnements de travail</h3>



  <!-- ===== CHANGER LES VERSIONS DE PYTHON ============================== -->

  <h4 id="py_version">Gérer les versions de Python avec pyenv</h4>

  <p>Pour connaître la version active de Python :</p>
  <pre><code class="language-svg">python --version</code></pre>

  <p>Pour connaître toutes les versions disponibles au téléchargement de Python 3.6 à 3.8 :</p>
  <pre><code class="language-svg">pyenv install --list | grep " 3\.[678]"</code></pre>

  <p> Toutes les versions s'installent dans un fichier <em>.pyenv/versions/</em>, qui vient s'insérer dans le PATH au coeur du
    système, et non pas directement dans un  environnement de développement. Ainsi, un environnement peut utiliser une
    version particulière de Python en pointant vers l'adresse de stockage de la version, sans qu'elle soit incorporée à
    cet environnement. Pour installer la version 3.7.2 en particulier :</p>
  <pre><code class="language-svg">pyenv install -v 3.7.2</code></pre>

  <p>Pour supprimer la version 2.7.15 de l'ordinateur :</p>
  <pre><code class="language-svg">pyenv uninstall 2.7.15</code></pre>
  <p>Attention de travailler avec une version 3 de Python et de ne pas supprimer la version 2 système de Python livrée
    d'usine et qui peut servir au fonctionnement de l'ordinateur. Ce n'est plus le cas pour Ubuntu 20.04 LTS qui fonctionne
    avec Python 3.8</p>

  <p>Il est important de bien connaître la version de Python utilisée avant de procéder à tout changement dans un
    environnement de développement, car chaque version accepte des dépendances différentes.</p>

  <p>Pour connaître toutes les versions disponibles sur l'ordinateur (la version active est précédée d'une *) :</p>
  <pre><code class="language-svg>">pyenv versions</code></pre>

  <p>Pour connaître l'adresse de la version de Python utilisée :</p>
  <pre><code class="language-svg">which python # ou encore
pyenv which python</code></pre>

  <p>Pour changer la version de Python en local dans l'environnement de développement :</p>
  <pre><code class="language-svg">pyenv local 3.7.1</code></pre>

  <p>Pour changer la version de Python pour tout l'ordinateur :</p>
  <pre><code class="language-svg">pyenv global 2.7.15</code></pre>

  <p>Pour revenir à la version système :</p>
  <pre><code class="language-svg">pyenv global system</code></pre>



  <h4>Particularité de l'utilisation de Anaconda</h4>

  <p>Pour télécharger l'environnement de travail Anaconda, il faut d'abord télécharger Anaconda pour Linux, vérifier le sha avec la commande :</p>
  <pre><code class="language-svg">sha256sum [nom_fichier_telecharge]</code></pre>

  <p>puis exécuter le fichier d'installation :</p>
  <pre><code class="language-svg">bash Anaconda-[version]-Linux-x86_64.sh</code></pre>

  <p>Finalement, il est possible de tester l'installation en utilisant :</p>
  <pre><code class="language-svg">conda list</code></pre>

  <p>Une fois qu'on a installé Anaconda, l'exécution se fait grâce à l'instruction :</p>
  <pre><code class="language-svg">anaconda-navigator</code></pre>

  <p>Pour mettre à jour Anaconda :</p>
  <pre><code class="language-svg">conda update conda</code></pre>

  <p>Pour connaître l'emplacement de conda :</p>
  <pre><code class="language-svg">which conda</code></pre>


  <!-- CREER DES ENVIRONNEMENTS DE TRAVAIL --------------------------->

  <h3 id="py_env">Créer des environnements de développement avec venv</h3>

  <p>Il est nécessaire de travailler dans des environnements virtuels pour isoler les dépendances de chaque projet Python.
    Pour cela, on utilise le module venv compris dans la librairie standard de Python3. Il est également possible d'utiliser
    virtualenv à la place de venv, mais ce dernier est déjà compris dans les versions de Python supérieures à 3.5 et ne
    nécessite donc pas d'installer virtualenv comme une dépendance.</p>

  <p>Au terminal, on crée tout d'abord le dossier qui va contenir mes environnements virtuels, puis on se place dedans :</p>

  <pre><code class="language-svg">mkdir environnements
cd environnements</code></pre>

  <p>On crée maintenant un nouvel environnement au sein du dossier environnements :</p>

  <pre><code class="language-svg">python3 -m venv mon_env</code></pre>

  <p>Pour visualier la structure de mon_env il suffit de taper tree dans le dossier courant.</p>

  <img src="../../images/memento/venv.png" alt="venv" width=80%>

  <p>bin contient les fichiers qui interagissent avec l'environnement virtuel, include contient les en-têtes C qui compilent
    les packages Python, lib contient une copie de la version Python avec un dossier de packages dans lequel sont installées
    toutes les dépendances.</p>

  <p>Il est maintenant nécessaire d'activer l'environnement virtuel comme environnement de travail. Pour cela, il faut se
    placer dans le dossier environnements et taper au Terminal :</p>

  <pre><code class="language-svg">source mon_env/bin/activate</code></pre>

  <p>A partir de maintenant, les commandes saisies ont une action dans l'environnement. On remarque que l'environnement
    est actif, car devant le prompt du Terminal apparaît (mon_env)$.</p>

  <p>Pour désactiver cet environnemnt virtuel, il suffit de taper :</p>

  <pre><code class="language-svg">deactivate</code></pre>

  <p>Pour installer un module dans l'environnement, il faut d'abord se rendre dans l'environnement puis :</p>
  <pre><code class="language-svg">cd mon_env
pip3 install nom_package</code></pre>

  <p>Pour désinstaller un module dans l'environnement :</p>
  <pre>pip3 uninstall nom_package</pre>

  <p>Pour voir la liste de tous les modules installés :</p>
  <pre><code class="language-svg">pip3 freeze</code></pre>

  <p>Pour utiliser une version particulière de Python dans l'environnement, il faut d'abord installer cette version sur
    l'ordinateur, puis se rendre dans l'environnement et définir cette version comme la version locale :</p>
  <pre><code class="language-svg">pyenv install 3.8.0
cd mon_env
pyenv local 3.8.0</code></pre>



  <!-- ===== UTILISATION DE PYCHARM DANS UN ENVIRONNEMENT ===== -->

  <h3 id="py_pycharm">Utilisation de PyCharm dans un environnement particulier</h3>

  <p>PyCharm crée automatiquement un dossier PyCharmProjects dans lequel il va ranger les différents projets. On peut
    alors choisir l'interpréteur parmi ceux proposés, et en fonction de ce qui a été installé (conda, virtualenv, une version
    particulière de Python ...). Pour cela, après avoir ouvert PyCharm, sélectionné le projet, puis File -> Settings ->
    Project Interpreter.</p>

  <p>On peut également utiliser un environnement lié à un projet déjà existant. Pour cela, on commence par créer un dossier
    dans lequel on crée l'environnement de développement avec venv, puis on ouvre PyCharm, on ouvre le projet existant,
    File -> Settings -> Project Interpreter. PyCharm devrait avoir reconnu l'environnement de travail et pointer directement
    vers la bonne version de Python, avoir les bons packages déjà installés. Si ces packages font défaut lors de l'exécution,
    l'erreur liée au package donne lieu à un signal rouge et un menu qui permet de confirmer l'installation du package.</p>















    <!-- ==== CREER UN PACKAGE ===== -->

    <h3 id="py_creer_package">Créer un package</h3>

    <p>Un package Python est organisé en fichiers ou classes, qui sont regroupées dans des modules. Les noms des packages et des modules seront écrits en minuscule et peuvent contenir des underscore. La structure à adopter est la suivante :</p>
    <pre>librairie // racine du package
  librairie/  // module Python
    __init__.py
    fichier.py
    main.py
    .gitignore
  setup.py</pre>

    <p>Le fichier .gitignore devra contenir :</p>
    <pre># compiled python modules
*.pyc

# setup tools distribution folder
/dist/

#python egg metadata, regenerated from source files by setuptools
/*.egg-info</pre>

    <p>Le fichier setup.py contient les commandes suivantes :</p>

    <pre><code class="language-python">from setuptools import setup

setup(name = "librairie",
  version = "1.0",
  description = "ma librairie",
  url = "http://github/librairie",
  author = "bob",
  author_email = "bob@gmail.com",
  licence = "xxx",
  packages = ['librairie'],
  install_requires = [ # list of dependancies
    'nomPakage',
  ],
  zip_safe = False)</code></pre>

    <p>L'installation d'un package en local sur Linux se fait avec la commande pip install librairie.</p>

    <p>Pour publier un package sur PyPI, il faut utiliser la commande python setup.py register</p>





    <!-- ===== CREER UN PACKAGE ===== -->

    <h3 id="py_package2">Créer un package avec Poetry</h3>

    <p>Il est possible de créer manuellement les fichiers build, manifestes et dépendances en utilisant pip ou conda.
      Toutefois, la gestion des compatibilités des dépendances n'est pas toujours assurée et la publication sur PyPI peut
      s'avérer impossible. Poetry est un outil complet ... Pour installer Poetry il faut écrire le script en ligne de commande :</p>

    <pre><code class="language-python">curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3</code></pre>

    <p>Ce script installe Poetry et il est nécessaire de relancer le Terminal pour modifier automatiquement le system PATH. On peut vérifier la bonne installation avec la
      commande :</p>

    <pre><code class="language-python">poetry --version</code></pre>

    <p>Pour générer un package, il ne faut pas créer de répertoire vide mais écrire directement :</p>

    <pre><code class="language-python">poetry new mon_package</code></pre>

    <p>qui crée le package dans un répertoire du même nom.</p>

    <p>La structure du package ressemble ainsi à ceci :</p>

    <img src="../../images/memento/poetry.png" alt="poetry" width=40%/>

    <p>Il faut ensuite ajouter des dépendances au fichier .toml dont la version sera enregistrée dans un fichier .lock. Bien
      qu'il soit possible de les ajouter manuellement, il est préférable d'utiliser la commande suivante qui gère la compatibilité
      des dépendances :</p>

    <pre><code class="language-python">poetry add un_module</code></pre>


    <!-- Tester le code -->
    <h3>Tester le code</h3>
